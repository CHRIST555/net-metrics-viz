global:
  resolve_timeout: 5m
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alertmanager@your-domain.com'
  # Optional: Add your time zone
  # smtp_hello: 'localhost'

# =====================================
# ROUTING CONFIGURATION
# =====================================
route:
  group_by: ['alertname', 'instance', 'severity']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h
  receiver: 'default-receiver'
  
  # Route different severity levels to different receivers
  routes:
    # Critical alerts go to multiple channels immediately
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 1h
    
    # Warning alerts go to standard channel
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 2m
      repeat_interval: 6h
    
    # Info alerts (like recoveries) go to a quieter channel
    - match:
        severity: info
      receiver: 'info-alerts'
      group_wait: 5m
      repeat_interval: 24h
    
    # Synology-specific routing
    - match:
        alert_type: storage
      receiver: 'storage-team'
      group_wait: 15s
      repeat_interval: 2h
    
    # Hardware alerts (disk temperature, fan issues)
    - match:
        alert_type: hardware
      receiver: 'hardware-team'
      group_wait: 30s
      repeat_interval: 4h
    
    # Network connectivity alerts
    - match:
        alert_type: connectivity
      receiver: 'network-team'
      group_wait: 30s

# =====================================
# NOTIFICATION RECEIVERS
# =====================================
receivers:
  # Default receiver
  - name: 'default-receiver'
    webhook_configs:
      - url: 'https://example.com/your-webhook-endpoint'
        send_resolved: true
        http_config:
          bearer_token: 'your-auth-token-here'  # if needed
        title: 'Synology NAS Alert: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        text: |
          {{ range .Alerts }}
          **Alert:** {{ .Annotations.summary }}
          **Description:** {{ .Annotations.description }}
          **Severity:** {{ .Labels.severity }}
          **NAS:** {{ .Labels.instance }}
          **Device:** {{ .Labels.device_name }}
          **Time:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

  # Critical alerts - multiple notification methods
  - name: 'critical-alerts'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/XXXXX/XXXXX/XXXXX'
        channel: '#synology-critical'
        send_resolved: true
        username: 'Synology-AlertManager'
        icon_emoji: ':rotating_light:'
        title: ' CRITICAL SYNOLOGY: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        text: |
          {{ range .Alerts }}
          *{{ .Annotations.summary }}*
          {{ .Annotations.description }}
          
          *Synology Details:*
          • Severity: {{ .Labels.severity }}
          • NAS: {{ .Labels.instance }}
          • Alert Type: {{ .Labels.alert_type }}
          • Started: {{ .StartsAt.Format "15:04:05" }}
          {{ if .Labels.device_name }}• Device Name: {{ .Labels.device_name }}{{ end }}
          {{ if .Labels.location }}• Location: {{ .Labels.location }}{{ end }}
          {{ if .Labels.disk_id }}• Disk ID: {{ .Labels.disk_id }}{{ end }}
          {{ if .Labels.disk_model }}• Disk Model: {{ .Labels.disk_model }}{{ end }}
          {{ end }}
        actions:
          - type: button
            text: 'View Grafana'
            url: 'http://localhost:3000'
          - type: button
            text: 'View Prometheus'
            url: 'http://localhost:9090'
          - type: button
            text: 'SNMP Exporter'
            url: 'http://localhost:9116'
    
    # Email for critical Synology alerts
    email_configs:
      - to: 'admin@your-domain.com'
        subject: ' CRITICAL: Synology NAS Alert - {{ range .Alerts }}{{ .Labels.device_name }}{{ end }}'
        body: |
          Critical alert from Synology NAS monitoring:
          
          {{ range .Alerts }}
          Alert: {{ .Annotations.summary }}
          Description: {{ .Annotations.description }}
          
          NAS Details:
          - Instance: {{ .Labels.instance }}
          - Device: {{ .Labels.device_name }}
          - Location: {{ .Labels.location }}
          - Alert Type: {{ .Labels.alert_type }}
          - Started: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ if .Labels.disk_id }}
          - Disk ID: {{ .Labels.disk_id }}
          - Disk Model: {{ .Labels.disk_model }}
          {{ end }}
          
          Dashboard: http://localhost:3000
          Prometheus: http://localhost:9090
          {{ end }}

  # Storage-specific alerts (disk issues, etc.)
  - name: 'storage-team'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/XXXXX/XXXXX/XXXXX'
        channel: '#storage-alerts'
        send_resolved: true
        username: 'Synology-Storage-Monitor'
        icon_emoji: ':floppy_disk:'
        title: ' STORAGE: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        text: |
          {{ range .Alerts }}
          *Storage Issue on Synology NAS:*
          {{ .Annotations.summary }}
          
          {{ .Annotations.description }}
          
          *Storage Details:*
          • NAS: {{ .Labels.instance }} ({{ .Labels.device_name }})
          • Location: {{ .Labels.location }}
          {{ if .Labels.disk_id }}• Disk ID: {{ .Labels.disk_id }}{{ end }}
          {{ if .Labels.disk_model }}• Disk Model: {{ .Labels.disk_model }}{{ end }}
          • Severity: {{ .Labels.severity }}
          • Started: {{ .StartsAt.Format "15:04:05" }}
          {{ end }}

  # Hardware alerts (temperature, fans, etc.)
  - name: 'hardware-team'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/XXXXX/XXXXX/XXXXX'
        channel: '#hardware-alerts'
        send_resolved: true
        username: 'Synology-Hardware-Monitor'
        icon_emoji: ':gear:'
        title: ' HARDWARE: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        text: |
          {{ range .Alerts }}
          *Hardware Issue on Synology NAS:*
          {{ .Annotations.summary }}
          
          {{ .Annotations.description }}
          
          *Hardware Details:*
          • NAS: {{ .Labels.instance }} ({{ .Labels.device_name }})
          • Location: {{ .Labels.location }}
          • Vendor: {{ .Labels.vendor }}
          {{ if .Labels.disk_id }}• Affected Disk: {{ .Labels.disk_id }} ({{ .Labels.disk_model }}){{ end }}
          • Severity: {{ .Labels.severity }}
          • Started: {{ .StartsAt.Format "15:04:05" }}
          {{ end }}

  # Warning alerts
  - name: 'warning-alerts'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/XXXXX/XXXXX/XXXXX'
        channel: '#synology-warnings'
        send_resolved: true
        username: 'Synology-Monitor'
        icon_emoji: ':warning:'
        title: ' WARNING: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        text: |
          {{ range .Alerts }}
          {{ .Annotations.summary }}
          {{ .Annotations.description }}
          
          NAS: {{ .Labels.instance }} ({{ .Labels.device_name }}) | Started: {{ .StartsAt.Format "15:04:05" }}
          {{ if .Labels.disk_id }}Disk: {{ .Labels.disk_id }} ({{ .Labels.disk_model }}){{ end }}
          {{ end }}

  # Info alerts (recoveries, etc.)
  - name: 'info-alerts'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/XXXXX/XXXXX/XXXXX'
        channel: '#synology-info'
        send_resolved: true
        username: 'Synology-Monitor'
        icon_emoji: ':information_source:'
        title: ' INFO: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        text: |
          {{ range .Alerts }}
          {{ .Annotations.summary }}
          {{ .Annotations.description }}
          
          NAS: {{ .Labels.instance }} ({{ .Labels.device_name }})
          {{ if .Labels.disk_id }}Disk: {{ .Labels.disk_id }} ({{ .Labels.disk_model }}){{ end }}
          {{ end }}

  # Network team specific alerts
  - name: 'network-team'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/XXXXX/XXXXX/XXXXX'
        channel: '#network-team'
        send_resolved: true
        username: 'Synology-Network-Monitor'
        icon_emoji: ':globe_with_meridians:'
        title: ' Network Alert: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        text: |
          {{ range .Alerts }}
          *Network Issue on Synology NAS:*
          {{ .Annotations.summary }}
          
          {{ .Annotations.description }}
          
          *Network Details:*
          • NAS: {{ .Labels.instance }} ({{ .Labels.device_name }})
          • Location: {{ .Labels.location }}
          • Vendor: {{ .Labels.vendor }}
          {{ if .Labels.ifDescr }}• Interface: {{ .Labels.ifDescr }}{{ end }}
          • Alert Type: {{ .Labels.alert_type }}
          • Started: {{ .StartsAt.Format "15:04:05" }}
          {{ end }}

# =====================================
# INHIBITION RULES
# =====================================
inhibit_rules:
  # If a Synology NAS is completely down, don't alert on its performance metrics
  - source_match:
      alertname: DeviceDown
    target_match_re:
      alertname: SynologyDisk.*|DiskTemperature.*|Interface.*|FanWarning
    equal: ['instance']

  # If an interface is down, don't alert on its low throughput
  - source_match:
      alertname: InterfaceDown
    target_match:
      alertname: InterfaceThroughputDrop
    equal: ['instance', 'ifDescr']
  
  # If system is critical, don't alert on individual disk issues
  - source_match:
      alertname: SynologySystemCritical
    target_match:
      alertname: SynologyDiskCritical
    equal: ['instance']
  
  # If disk is critical, don't alert on its temperature
  - source_match:
      alertname: SynologyDiskCritical
    target_match:
      alertname: DiskTemperatureCritical
    equal: ['instance', 'disk_id']

# =====================================
# TEMPLATES (Optional - for custom formatting)
# =====================================
templates:
  - '/etc/alertmanager/templates/*.tmpl'

