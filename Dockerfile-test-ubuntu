# Dockerfile-test-ubuntu
FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive

# Install SNMP agent and basic tools
RUN apt-get update && \
    apt-get install -y snmp snmpd iputils-ping net-tools curl vim && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Configure SNMPv2c
RUN sed -i 's/^agentAddress.*/agentAddress udp:161,udp6:[::1]:161/' /etc/snmp/snmpd.conf && \
    sed -i 's/^#com2sec notConfigUser  default    public/com2sec notConfigUser  default    public/' /etc/snmp/snmpd.conf && \
    sed -i 's/^#group MyRWGroup v1       notConfigUser/group MyRWGroup v1       notConfigUser/' /etc/snmp/snmpd.conf && \
    sed -i 's/^#group MyRWGroup v2c      notConfigUser/group MyRWGroup v2c      notConfigUser/' /etc/snmp/snmpd.conf && \
    sed -i 's/^#view all    included  .1/view all    included  .1/' /etc/snmp/snmpd.conf && \
    sed -i 's/^#access MyRWGroup ""      any       noauth    exact  all    all    none/access MyRWGroup ""      any       noauth    exact  all    all    none/' /etc/snmp/snmpd.conf

# Expose SNMP UDP port
EXPOSE 161/udp

# Run SNMP in foreground for Docker
CMD ["/usr/sbin/snmpd", "-f", "-Lo"]